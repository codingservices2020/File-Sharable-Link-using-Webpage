<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024">
  <title>Secure File Sharing</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <h1>Upload & Share File</h1>
      </div>
     <div class="clear"></div>
    </div>

    <div class="menu">
      <a href="#" class="headerlink">Upload</a>&nbsp; | &nbsp;
      <a href="#" class="headerlink">Register</a>&nbsp; | &nbsp;
      <a href="#" class="headerlink">FAQ</a>&nbsp; | &nbsp;
      <a href="#" class="headerlink">Report files</a>&nbsp; | &nbsp;
      <a href="#" class="headerlink">Feedback</a>&nbsp; | &nbsp;
      <a href="{{ url_for('rules') }}" class="headerlink">Rules</a>
    </div>

    <div class="upload-container">
      <form id="uploadForm">
        <table cellpadding="0" cellspacing="10" border="0" width="90%" bgcolor="#f7f7f7" align="center" style="border:1px solid #ddd;">
          <tr>
            <td align="center">
              <noscript><span class="error-message">ERROR: Javascript must be allowed.</span></noscript>
              <table cellpadding="0" cellspacing="4" border="0">
                <tr>
                  <td align="right"><b>* Choose file:</b></td>
                  <td align="left"><input type="file" name="file" id="file" class="input" size="40" required /></td>
                </tr>
              </table>

              <hr />
              <input type="reset" id="reset_button" name="reset_button" class="submitButtonLB" value="Reset" />&nbsp;
              <input type="submit" id="upload_button" name="upload_button" value="Upload" class="uploadbutton" />
              <hr />
              <span class="smalltxt">By pressing "Upload" you confirm that you have read and agreed to our <a href="{{ url_for('rules') }}" >rules</a>.</span>
            </td>
          </tr>
        </table>
      </form>

      <div class="error-message" id="errorMessage" style="display:none;"></div>

      <!-- Circular loader -->
      <div id="loader" style="display:none; text-align:center;">
        <div class="loader-circle">
          <i class="fas fa-circle-notch fa-spin"></i>
        </div >
        <p>Uploading your file...</p>
      </div>

      <div class="file-info">
        <b>Uploaded files info:</b>
        <ul>
            <li>Maximum filesize 100 megabytes (MB)</li>
            <li>Waiting time 0 seconds</li>
            <li>Maximum download speed</li>
            <li>Files expire after 30 days</li>
            <li>All most used file extensions are supported</li>
        </ul>
      </div>
    </div>

    <div class="footer">
      <div style="padding-left:280px">
        <table cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td valign="middle" class="lightblue bold">NB! We are not responsible for files uploaded here!</td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const fileInput = document.getElementById('file');
      const errorMessage = document.getElementById('errorMessage');
      const loader = document.getElementById('loader');
      const uploadButton = document.getElementById('upload_button');

      // Reset any previous errors
      errorMessage.style.display = 'none';

      if (fileInput.files.length === 0) {
        errorMessage.textContent = 'Please select a file first';
        errorMessage.style.display = 'block';
        return;
      }

      // Show loader
      loader.style.display = 'block';
      uploadButton.disabled = true;

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          window.location.href = `/result?link=${encodeURIComponent(data.short_link)}`;
        } else {
          throw new Error(data.error || 'Upload failed');
        }
      })
      .catch(error => {
        errorMessage.textContent = error.message;
        errorMessage.style.display = 'block';
      })
      .finally(() => {
        loader.style.display = 'none';
        uploadButton.disabled = false;
      });
    });
  </script>
</body>
</html>
